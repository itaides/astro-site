---
import { ClientRouter } from "astro:transitions";
import Agent from "../components/Agent.astro";
import "../styles/main.css";

interface Props {
	title: string;
	description?: string;
}

const {
	title,
	description = "Arctica Digital â€” Strategy-led branding and digital design studio building products and experiences that move culture forward.",
} = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content={description} />
		<meta name="theme-color" content="#fafafa" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600;700;800&display=swap"
			rel="stylesheet"
		/>

		<!-- Open Graph -->
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		<meta property="og:site_name" content="Arctica Digital" />

		<title>{title}</title>
		<ClientRouter />
	</head>
	<body>
		<a href="#main" class="sr-only">Skip to main content</a>
		<div class="cursor-dot" id="cursor-dot"></div>
		<slot name="header" />
		<main id="main">
			<slot />
		</main>
		<slot name="footer" />
		<Agent />

		<script>
			// ====== CSS Reveal System ======
			function initReveals() {
				const observerOptions = {
					root: null,
					rootMargin: "0px",
					threshold: 0.15,
				};

				const observer = new IntersectionObserver((entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							entry.target.classList.add("is-visible");
							observer.unobserve(entry.target);
						}
					});
				}, observerOptions);

				document
					.querySelectorAll(".reveal-up, .reveal-stagger")
					.forEach((el) => {
						observer.observe(el);
					});
			}

			// ====== Custom Cursor ======
			function initCursor() {
				const cursor = document.getElementById("cursor-dot");
				if (cursor && window.matchMedia("(pointer: fine)").matches) {
					let mx = 0,
						my = 0;
					let cx = 0,
						cy = 0;

					const mouseMoveHandler = (e: MouseEvent) => {
						mx = e.clientX;
						my = e.clientY;
					};
					document.addEventListener("mousemove", mouseMoveHandler);

					function animateCursor() {
						cx += (mx - cx) * 0.15;
						cy += (my - cy) * 0.15;
						if (cursor) {
							cursor.style.left = cx + "px";
							cursor.style.top = cy + "px";
						}
						requestAnimationFrame(animateCursor);
					}
					animateCursor();

					const updateHovers = () => {
						document
							.querySelectorAll(
								"a, button, .project-card, .post-row, .work-item, .service-row",
							)
							.forEach((el) => {
								el.addEventListener("mouseenter", () =>
									cursor?.classList.add("cursor-dot--hover"),
								);
								el.addEventListener("mouseleave", () =>
									cursor?.classList.remove(
										"cursor-dot--hover",
									),
								);
							});
					};
					updateHovers();
				} else if (cursor) {
					cursor.style.display = "none";
				}
			}

			// ====== Mobile Nav Toggle ======
			function initNav() {
				const navToggle = document.getElementById("nav-toggle");
				const navMenu = document.getElementById("nav-menu");
				const navOverlay = document.getElementById("nav-overlay");

				if (navToggle && navMenu) {
					const toggleMenu = (open?: boolean) => {
						const isOpen =
							typeof open === "boolean"
								? open
								: navMenu.classList.contains("open");
						if (isOpen) {
							navMenu.classList.remove("open");
							navOverlay?.classList.remove("open");
							navToggle.setAttribute("aria-expanded", "false");
							document.body.style.overflow = "";
						} else {
							navMenu.classList.add("open");
							navOverlay?.classList.add("open");
							navToggle.setAttribute("aria-expanded", "true");
							document.body.style.overflow = "hidden";
						}
					};

					navToggle.addEventListener("click", () => toggleMenu());
					navOverlay?.addEventListener("click", () =>
						toggleMenu(true),
					);
					navMenu.querySelectorAll("a").forEach((link) => {
						link.addEventListener("click", () => toggleMenu(true));
					});
				}
			}

			// Initialize on initial load and after view transitions
			const init = () => {
				initReveals();
				initCursor();
				initNav();
			};

			document.addEventListener("astro:page-load", init);
		</script>
	</body>
</html>
